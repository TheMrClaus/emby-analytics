(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(7246)}])},7246:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var i=s(5893),r=s(7294),d=s(4715),n=s(723),a=s(5615),o=s(8793),l=s(4570),c=s(8042),h=s(1712),u=s(9984),x=s(2764);function p(){let[e,t]=(0,r.useState)([]),[s,p]=(0,r.useState)([]),[j,y]=(0,r.useState)({}),[g,f]=(0,r.useState)([]),[m,v]=(0,r.useState)([]),[b,w]=(0,r.useState)({running:!1,imported:0,total:0,page:0,error:null}),[S,T]=(0,r.useState)({}),[k,M]=(0,r.useState)({}),[R,_]=(0,r.useState)([]),[E,A]=(0,r.useState)(0),[C,F]=(0,r.useState)(!1),[K,N]=(0,r.useState)(null),[W,I]=(0,r.useState)({}),U=e=>!isFinite(e)||e<=0?"0m":e<1/60?"".concat(Math.round(3600*e),"s"):e<1?"".concat(Math.round(60*e),"m"):e<10?"".concat(e.toFixed(1),"h"):"".concat(Math.round(e),"h"),O=e=>{if(!isFinite(e)||e<=0)return"0m";let t=Math.round(60*e);if(t<1)return"".concat(Math.round(3600*e),"s");if(t<60)return"".concat(t,"m");let s=Math.floor(t/60),i=t%60;return i?"".concat(s,"h ").concat(i,"m"):"".concat(s,"h")};(0,r.useEffect)(()=>{fetch("".concat("","/stats/usage?days=14")).then(e=>e.json()).then(p),fetch("".concat("","/stats/overview")).then(e=>e.json()).then(y),fetch("".concat("","/stats/top/users?window=14d&limit=5")).then(e=>e.json()).then(f),fetch("".concat("","/stats/top/items?window=14d&limit=5")).then(e=>e.json()).then(v),fetch("".concat("","/stats/qualities")).then(e=>e.json()).then(T),fetch("".concat("","/stats/codecs?limit=8")).then(e=>e.json()).then(M),fetch("".concat("","/stats/active-users-lifetime?limit=1")).then(e=>e.json()).then(_),fetch("".concat("","/stats/users/total")).then(e=>e.json()).then(e=>A(e.total_users||0));let e=new EventSource("".concat("","/now/stream"));return e.onmessage=e=>t(JSON.parse(e.data||"[]")),()=>e.close()},[]),(0,r.useEffect)(()=>{let e=!1,t=async()=>{try{let t=await fetch("".concat("","/admin/refresh/status")).then(e=>e.json());!e&&t&&w(t)}catch(e){}},s=setInterval(t,1500);return t(),()=>{e=!0,clearInterval(s)}},[]),(0,r.useEffect)(()=>{let e=Array.from(new Set(m.map(e=>e.item_id).filter(Boolean)));if(!e.length){I({});return}fetch("".concat("","/items/by-ids?ids=").concat(encodeURIComponent(e.join(",")))).then(e=>e.json()).then(e=>{let t={};e.forEach(e=>{t[e.id]=e.display||e.name||e.type||e.id}),I(t)}).catch(()=>{})},[m]);let P=(0,r.useMemo)(()=>Array.from(new Set(s.map(e=>e.day))).sort(),[s]),D=(0,r.useMemo)(()=>Array.from(new Set(s.map(e=>e.user))),[s]),z=(0,r.useMemo)(()=>P.map(e=>{let t={day:e};return D.forEach(i=>{t[i]=s.filter(t=>t.day===e&&t.user===i).reduce((e,t)=>e+t.hours,0)}),t}),[P,D,s]),B=(0,r.useMemo)(()=>m.map(e=>({item:W[e.item_id||""]||e.item_id||"Unknown",hours:e.hours})),[m,W]),L=async()=>{try{let e=await fetch("".concat("","/admin/refresh"),{method:"POST"}).then(e=>e.json());((null==e?void 0:e.started)||(null==e?void 0:e.running))&&w(e=>({...e,running:!0})),N((null==e?void 0:e.started)?"Library refresh started":"Library refresh already running")}catch(e){N("Failed to start library refresh")}finally{setTimeout(()=>N(null),2e3)}},J=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;for(let s=0;s<e;s++){try{let e=await fetch("".concat("","/stats/users/total")).then(e=>e.json());A(e.total_users||0)}catch(e){}await new Promise(e=>setTimeout(e,t))}},X=async()=>{if(!C){F(!0);try{let e=await fetch("".concat("","/admin/users/sync"),{method:"POST"}).then(e=>e.json()).catch(()=>null);N((null==e?void 0:e.started)?"User sync started":"User sync already running"),J()}catch(e){N("Failed to start user sync")}finally{setTimeout(()=>N(null),2500),F(!1)}}},$=e=>Math.max(0,Math.min(100,e||0));return(0,i.jsxs)("div",{style:{padding:20,fontFamily:"system-ui, sans-serif"},children:[K&&(0,i.jsx)("div",{style:{position:"fixed",top:14,right:14,background:"#333",color:"#fff",padding:"8px 12px",borderRadius:8,boxShadow:"0 2px 12px rgba(0,0,0,.15)",zIndex:9999},children:K}),(0,i.jsx)("h1",{children:"Emby Analytics"}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap",marginTop:8},children:[(0,i.jsx)("button",{onClick:L,disabled:b.running,style:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:8,cursor:b.running?"not-allowed":"pointer"},children:b.running?"Importing...":"Refresh Library"}),(0,i.jsx)("button",{onClick:X,disabled:C,style:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:8,cursor:C?"not-allowed":"pointer"},children:C?"Syncing…":"Sync Users"}),b.running&&(0,i.jsxs)("div",{style:{minWidth:260},children:[(0,i.jsx)("div",{style:{height:8,background:"#eee",borderRadius:6,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:8,width:(()=>{let e=b.total||0;if(!e)return"100%";let t=b.imported/Math.max(1,e)*100;return"".concat(Math.max(1,Math.min(100,t)),"%")})(),background:"#666",borderRadius:6,transition:"width .3s"}})}),(0,i.jsxs)("div",{style:{fontSize:12,color:"#555",marginTop:4},children:["Imported ",b.imported,b.total?" / ".concat(b.total):""," • page ",b.page]})]}),b.error&&(0,i.jsxs)("span",{style:{color:"#c00"},children:["Error: ",b.error]})]}),(0,i.jsx)("h2",{style:{marginTop:16},children:"Now Playing"}),(0,i.jsxs)("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))"},children:[0===e.length&&(0,i.jsx)("div",{children:"Nothing playing."}),e.map((e,t)=>(0,i.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:12,padding:12,display:"flex",gap:12},children:[e.poster?(0,i.jsx)("img",{src:e.poster,alt:"",width:90,height:135,style:{objectFit:"cover",borderRadius:8}}):(0,i.jsx)("div",{style:{width:90,height:135,background:"#eee",borderRadius:8}}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsx)("div",{style:{fontWeight:700,overflow:"hidden",textOverflow:"ellipsis"},title:e.title,children:e.title||"—"}),(0,i.jsxs)("div",{style:{color:"#555"},children:[e.user," • ",e.app,e.device?" • ".concat(e.device):""]}),(0,i.jsxs)("div",{style:{marginTop:6,display:"flex",gap:6,flexWrap:"wrap",fontSize:12},children:[(0,i.jsx)("span",{style:{padding:"2px 6px",border:"1px solid #ddd",borderRadius:8},children:e.play_method||("Transcode"===e.video||"Transcode"===e.audio?"Transcode":"Direct")}),(0,i.jsxs)("span",{style:{padding:"2px 6px",border:"1px solid #ddd",borderRadius:8},children:["Video: ",e.video]}),(0,i.jsxs)("span",{style:{padding:"2px 6px",border:"1px solid #ddd",borderRadius:8},children:["Audio: ",e.audio]}),(0,i.jsxs)("span",{style:{padding:"2px 6px",border:"1px solid #ddd",borderRadius:8},children:["Subs: ",e.subs]}),"number"==typeof e.bitrate&&(0,i.jsxs)("span",{style:{padding:"2px 6px",border:"1px solid #ddd",borderRadius:8},children:[(e.bitrate/1e6).toFixed(2)," Mbps"]})]}),(0,i.jsx)("div",{style:{marginTop:8,height:8,background:"#eee",borderRadius:6},children:(0,i.jsx)("div",{style:{height:8,width:"".concat($(e.progress_pct),"%"),background:"#666",borderRadius:6}})})]})]},t))]}),(0,i.jsx)("h2",{style:{marginTop:24},children:"Usage (last 14 days)"}),(0,i.jsx)("div",{style:{width:"100%",height:320},children:(0,i.jsx)(d.h,{children:(0,i.jsxs)(n.w,{data:z,children:[(0,i.jsx)(a.K,{dataKey:"day"}),(0,i.jsx)(o.B,{tickFormatter:U}),(0,i.jsx)(l.u,{formatter:(e,t)=>[O(Number(e)),t]}),(0,i.jsx)(c.D,{}),D.map(e=>(0,i.jsx)(h.x,{type:"monotone",dataKey:e,dot:!1},e))]})})}),(0,i.jsxs)("div",{style:{display:"grid",gap:16,gridTemplateColumns:"repeat(auto-fit,minmax(300px,1fr))",marginTop:24},children:[(0,i.jsxs)("div",{style:{background:"#3aaa35",color:"#fff",borderRadius:10,padding:12},children:[(0,i.jsx)("div",{style:{fontWeight:700,textAlign:"center"},children:"Media Qualities"}),(0,i.jsxs)("table",{style:{width:"100%",marginTop:8},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{}),(0,i.jsx)("th",{children:"Movies"}),(0,i.jsx)("th",{children:"Episodes"})]})}),(0,i.jsx)("tbody",{children:["4K","1080p","720p","SD","Unknown"].map(e=>{var t,s,r,d;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e}),(0,i.jsx)("td",{style:{textAlign:"right"},children:(null===(s=S.buckets)||void 0===s?void 0:null===(t=s[e])||void 0===t?void 0:t.Movie)||0}),(0,i.jsx)("td",{style:{textAlign:"right"},children:(null===(d=S.buckets)||void 0===d?void 0:null===(r=d[e])||void 0===r?void 0:r.Episode)||0})]},e)})})]})]}),(0,i.jsxs)("div",{style:{background:"#3aaa35",color:"#fff",borderRadius:10,padding:12},children:[(0,i.jsx)("div",{style:{fontWeight:700,textAlign:"center"},children:"Media Codecs"}),(0,i.jsxs)("table",{style:{width:"100%",marginTop:8},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{}),(0,i.jsx)("th",{children:"Movies"}),(0,i.jsx)("th",{children:"Episodes"})]})}),(0,i.jsx)("tbody",{children:(k.codecs?Object.keys(k.codecs):[]).map(e=>{var t,s;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e}),(0,i.jsx)("td",{style:{textAlign:"right"},children:(null===(t=k.codecs[e])||void 0===t?void 0:t.Movie)||0}),(0,i.jsx)("td",{style:{textAlign:"right"},children:(null===(s=k.codecs[e])||void 0===s?void 0:s.Episode)||0})]},e)})})]})]}),(0,i.jsxs)("div",{style:{background:"#3aaa35",color:"#fff",borderRadius:10,padding:12},children:[(0,i.jsx)("div",{style:{fontWeight:700,textAlign:"center"},children:"Most Active Users"}),0===R.length?(0,i.jsx)("div",{children:"—"}):(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto auto",gap:8,marginTop:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:R[0].user}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Days"}),(0,i.jsx)("br",{}),R[0].days]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Hours"}),(0,i.jsx)("br",{}),R[0].hours]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Minutes"}),(0,i.jsx)("br",{}),R[0].minutes]})]})]}),(0,i.jsxs)("div",{style:{background:"#3aaa35",color:"#fff",borderRadius:10,padding:12,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,i.jsx)("div",{style:{fontWeight:700},children:"Total Users"}),(0,i.jsx)("div",{style:{fontSize:28,fontWeight:800},children:E})]})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:24,gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",marginTop:24},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{children:"Top users (14d)"}),(0,i.jsx)("div",{style:{width:"100%",height:260},children:(0,i.jsx)(d.h,{children:(0,i.jsxs)(u.v,{data:g.map(e=>({user:e.user,hours:e.hours})),children:[(0,i.jsx)(a.K,{dataKey:"user"}),(0,i.jsx)(o.B,{tickFormatter:U}),(0,i.jsx)(l.u,{formatter:e=>[O(e),"time"]}),(0,i.jsx)(x.$,{dataKey:"hours"})]})})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{children:"Top items (14d)"}),(0,i.jsx)("div",{style:{width:"100%",height:260},children:(0,i.jsx)(d.h,{children:(0,i.jsxs)(u.v,{data:B,children:[(0,i.jsx)(a.K,{dataKey:"item"}),(0,i.jsx)(o.B,{tickFormatter:U}),(0,i.jsx)(l.u,{formatter:e=>[O(e),"time"]}),(0,i.jsx)(x.$,{dataKey:"hours"})]})})})]})]}),(0,i.jsx)("h2",{style:{marginTop:24},children:"Library overview"}),(0,i.jsx)("pre",{style:{whiteSpace:"pre-wrap",background:"#fafafa",border:"1px solid #eee",borderRadius:8,padding:12},children:JSON.stringify(j,null,2)})]})}}},function(e){e.O(0,[808,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);